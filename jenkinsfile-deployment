pipeline{
    agent{
        label "ANSIBLE"
    }
    parameters {
        
        choice(name: 'ENV', choices: ['DEV', 'PROD', ], description: 'finding the env')
        string(name: 'COMPONENT', defaultValue: ' ', description: 'Which component is deploy')
        string(name: 'VERSION', defaultValue: ' ', description: 'Which version of the component is to be deploy')
    }
    stages{

        stage('Find The server'){
            steps{
                sh '''aws ec2 describe-instances --filters "Name=tag:Name,Values=${COMPONENT}" --region us-east-1 | jq .Reservations[].Instances[].PrivateIpAddress | xargs -n1 > inv'''
            }
        }
            stage('Deploy to DEV ENV'){
                when{
                environment name: 'ENV', value: 'DEV'

                }
                steps{
                   sh "echo ansible-playbook-------"
                }
            }
            stage('Deploy To PROD ENV') {
                when {
                environment name: 'ENV', value: 'PROD'
                }
                steps{
                    sh "echo ansible-playbood---------"
                }
            }
        }
    }

